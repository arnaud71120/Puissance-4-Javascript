<html>
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 <meta http-equiv="Content-Language" content="fr" />
 <style type="text/css">
body {
  background-image: url("background.jpg");
}
</style>
 <title>
 Puissance 4
</title>
</head>
<body style="background-image: url('images/background.jpg')">
<center>
  <div id="menu">
  <h1 style="color:blue;">Jeu du Puissance 4</h1>
  <button id="buttonStart1" type="button" onclick="vsJoueur()">Démarrer la partie Joueur VS Joueur</button>
  <button id="buttonStart2" type="button" onclick="vsIa()">Démarrer la partie Joueur VS IA</button>
  <h2 style="color:red;" id="victoire"></h2>
</div>
</center>
<div id="tableau" style="left: 40%; width: 350px; position: absolute; top: 20%; height: 600px ">
</div>
<center>


</body>
</html>
<script>
var noBtn;
var nbVictoire1 =0;
var nbVictoire2 =0;
var tab, tabJoueur, victoire;
var iA;
function vsJoueur(){
  iA = false;
  startGame();
}
function vsIa(){
  iA = true;
  startGame();
}
function startGame(){
 noBtn = 0;
var btn =  document.getElementById('buttonStart1');
btn.parentNode.removeChild(btn);
var btn2 =  document.getElementById('buttonStart2');
btn2.parentNode.removeChild(btn2);

  var jeton, joueur;
  victoire = 0
  initJoueur();
   tab = tableauInit();
   tabJoueur = choixJoueurInit();

  initGrille();
  var score = document.getElementById('tableau').innerHTML += '<div id="score"><p style="color:red;">Joueur 1 : '+nbVictoire1+'</p><p style="color:blue;">Joueur 2 : '+nbVictoire2+'</p></div>';

}

function restartGame(){
   noBtn = 0;
  var btn =  document.getElementById('restartGame');
  btn.parentNode.removeChild(btn);
  var removeScore =  document.getElementById('score');
    removeScore.parentNode.removeChild(removeScore);
    document.getElementById('victoire').innerHTML = "";
    var jeton, joueur;
    victoire = 0
    initJoueur();
     tab = tableauInit();
     tabJoueur = choixJoueurInit();

    initGrille();
    var score = document.getElementById('tableau').innerHTML += '<div id="score"><p style="color:red;">Joueur 1 : '+nbVictoire1+'</p><p style="color:blue;">Joueur 2 : '+nbVictoire2+'</p></div>';

}
var jeton, joueur;
function initJoueur(){
  jeton = "jetonjaune.gif";
  joueur = 1;
}

function changeJoueur(){
  if(joueur == 1){
    joueur = 2;
    jeton = "jetonrouge.gif";
  }else{
    joueur = 1;
    jeton = "jetonjaune.gif";
  }
}
function changeJoueurIa(){
  if(joueur == 1){
    joueur = 2;
    jeton = "jetonrouge.gif";
    iaOrdi();
  }else{
    joueur = 1;
    jeton = "jetonjaune.gif";
  }
}
function tableauInit(){
var tab = new Array();
  for(var i = 0 ; i < 7 ; i++){
    tab[i] = new Array();
      for (var y = 0 ; y < 6 ; y++){
        tab[i].push(false)
          }
  }
  return tab;
}


function choixJoueurInit(){
var tabJoueur = new Array();
  for(var i = 0 ; i < 7 ; i++){
    tabJoueur[i] = new Array();
      for (var y = 0 ; y < 6 ; y++){
        tabJoueur[i].push(false)
          }
  }
  return tabJoueur;
}



function initGrille(){
  var tr1 = new Array();

    for(var i = 0 ; i < 6 ; i++){
      if (i == 0){
        tr = '<table cellspacing="0" cellpadding="0" width="350"><tbody><tr id="Ligne'+i+'">';
      }else{
       tr = '<tr id="Ligne'+i+'">';
     }
        for (var y = 0 ; y < 7 ; y++){
          tr += '<td id="Colonne'+y+'" onclick="addJetons('+y+');"><img src="images/case.gif"> </td>';
            }
            if(i == 6){
            tr += '</tr></tbody></table>';
          }
          else {
          tr +='</tr>';
          }
            tr1.push(tr);
    }
    document.getElementById("tableau").innerHTML = tr1;
}
function iaOrdi(){
  var jouer=0;
    for (var i = 5 ; i >= 0 ; i--){
      if(jouer == 0){
      for(var y = 6 ; y >= 0 ; y--){
         if(tabJoueur[y][i] == 1){ //defense
           comptVertical=0;
           comptVertical2=0;
           comptHorizontal=0;
           comptFalse=0;
           var myY2 = y-3;
           for(var p=2; p >0; p--){
             var myY = y-p;
             if(tabJoueur[myY][i]== 1 ){
               comptVertical++;
             }

           }
           for(var p=3; p >0; p--){
             var myY = y-p;
             if(myY >=0){
             if(tabJoueur[myY][i]== 1){
               comptVertical2++;
             }
           }
           if(myY >=0){
             if(tabJoueur[myY][i]== false){
               comptFalse = myY;
             }
           }
           }
           if(comptVertical == 2 && myY2 >=0 &&  tabJoueur[myY2][i]== false){

             addJetons(myY2);
             jouer=1;
             break;
           }
           if(comptVertical2 == 2 && comptFalse !=0 ){

             addJetons(comptFalse);
             jouer=1;
             break;
           }
        }
        if(tabJoueur[y][i] == false){ // si la case est vide
          if(y != 6){ // si on ne se situe pas sur la premiere case
            var myI = i; // on enleve 1 pour checker si la case précédente nous appartient
            var myY = y+1;
            if(tabJoueur[myY][myI] == 2){ // si la case nous appartient

              var newMyY = y+1;
              var compt = 0;
              for(var b=0; b >2; b++){ // on boucle pour regarder si les 2 prochaines case sont vide
                if(tabJoueur[newMyY][i] == false){
                  compt++;
                }
              }
              if(compt == 2){ // les deux prochaines cases sont vide, donc on peut insérer le jeton
                addJetons(y);
                break;
              }
            }else{ // si la case ne nous appart pas
              var newMyY = y+1;
              var compt = 0;
              for(var b= newMyY; b > newMyY-3; b--){
                  if( b>=0){
                if(tabJoueur[b][i] == false ){
                  compt++;
                }}
              }
              if(compt == 3){ // les trois prochaines cases sont vide, donc on peut insérer le jeton

                addJetons(newMyY);
                jouer = 1;
                break;
              }
            }
          }

        }
        else if(tabJoueur[y][i] == 2){
          lastJoueur= tabJoueur[y][i];
          for(o=i; o <=0;o--){
            if(o <= 3){
              break;
            }
            if(tabJoueur[y][o]==false ){
              if(lastJoueur == 2 ){
                addJetons(y);
                jouer = 1;
              }
            }
            lastJoueur=tabJoueur[y][o];

          }

        }
        else{
          break;
        }
        }
      }
    }
    }

function addJetons(value){
  if(victoire == 0){
  for(var i = 5 ; i >= 0 ; i--){
    if (tab[value][i] == false){
      tab[value][i] = true;
      tabJoueur[value][i] = joueur;
      var Ligne = 'Ligne' + i;
      var Parent = document.getElementById(Ligne);

      Parent.childNodes[value].innerHTML = '<img style="position: absolute; z-index: 1;" src="images/'+jeton+'"><img src="images/case.gif"> ';

      testVainqueur();
      if(iA== true){
      changeJoueurIa();
    }
    else{
      changeJoueur();
    }
      break;
    }
    if(i == 0 && tab[value][i] == true ){
      alert('Colonne pleine ! \n Veuillez choissir une autre colonne');
      break;
    }
      }
    }
    if(victoire == 1 && noBtn == 0){
      noBtn = 1;
      var Menu = document.getElementById('menu');
      Menu.innerHTML += '<button id="restartGame" type="button" onclick="restartGame()"> Recommencer une partie </button>';
    }
}

function testVainqueur(){
  var lastJoueur;
  var comptLigne=0;
  // test victoire sur ligne horizontal
  for (var i = 5 ; i >= 0 ; i--){
    var lastJoueur;
    var comptLigne=0;
  for(var y = 6 ; y >= 0 ; y--){
    if(tabJoueur[y][i] != false){
      if(lastJoueur == tabJoueur[y][i] ){
        if(comptLigne >= 0 && comptLigne <= 4){
        comptLigne++;}
        else{
          comptLigne =1
        }
      }else{
        comptLigne = 1;
      }
      lastJoueur = tabJoueur[y][i];
      if(comptLigne == 4){
        victoire = 1;
        document.getElementById('victoire').innerHTML = "Victoire du Joueur " + + tabJoueur[y][i] ;
        if(tabJoueur[y][i] == 1){
          nbVictoire1++;
        }else{
          nbVictoire2++;
        }
      }
    }else{
      comptLigne =0;
    }
    }
  }

  // test victoire sur ligne vertical
  for (var i = 6 ; i >= 0 ; i--){

    var lastJoueurVertical;
    var comptColonne=0;
  for(var y = 5 ; y >= 0 ; y--){
    if(tabJoueur[i][y] != false){
      if(lastJoueurVertical == tabJoueur[i][y] ){
        if(comptColonne >= 0 && comptColonne <= 4){
        comptColonne++;}
        else{
          comptColonne =1
        }
      }else{
        comptColonne = 1;
      }
      lastJoueurVertical = tabJoueur[i][y];
      if(comptColonne == 4){
        victoire = 1;
        document.getElementById('victoire').innerHTML = "Victoire du Joueur " +  tabJoueur[i][y] ;
        if(tabJoueur[i][y] == 1){
          nbVictoire1++;
        }else{
          nbVictoire2++;
        }
      }
    }
    }
  }


  // test victoire sur ligne diagonale gauche
  for (var i = 5 ; i >= 0 ; i--){

    var lastJoueurDiagGauche;
    var comptColonneDiagGauche=0;
  for(var y = 6 ; y >= 0 ; y--){

    if(tabJoueur[y][i] != false){
      var varI= i;
      var varY = y;
      if( y >= 3 && i >=3 ){
        lastJoueurDiagGauche="";
        for (var g= 0; g < 4; g++){

      if(lastJoueurDiagGauche == tabJoueur[varY][varI] ){

        if(comptColonneDiagGauche >= 0 && comptColonneDiagGauche <= 4){
        comptColonneDiagGauche++;}
        else{
          comptColonneDiagGauche =1
      }
      }


      else{
        comptColonneDiagGauche = 1;
      }


      lastJoueurDiagGauche = tabJoueur[varY][varI];
      if(comptColonneDiagGauche == 4){
        victoire = 1;
        document.getElementById('victoire').innerHTML = "Victoire du Joueur " + + tabJoueur[y][i] ;
        if(tabJoueur[y][i] == 1){
          nbVictoire1++;
        }else{
          nbVictoire2++;
        }
      }
      varI--;
      varY--;
    }
  }
}


    }
  }



  // test victoire sur ligne diagonale droite
  for (var i = 5 ; i >= 0 ; i--){

    var lastJoueurDiagDroite;
    var comptColonneDiagDroite=0;
  for(var y = 6 ; y >= 0 ; y--){

    if(tabJoueur[y][i] != false){
      var varI= i;
      var varY = y;
      if( y <= 3 && i >=3 ){
        lastJoueurDiagDroite="";
        for (var g= 0; g < 4; g++){

      if(lastJoueurDiagDroite == tabJoueur[varY][varI] ){

        if(comptColonneDiagDroite >= 0 && comptColonneDiagDroite <= 4){
        comptColonneDiagDroite++;}
        else{
          comptColonneDiagDroite =1;
      }
      }


      else{
        comptColonneDiagDroite = 1;
      }
      lastJoueurDiagDroite = tabJoueur[varY][varI];
      if(comptColonneDiagDroite == 4){
        victoire = 1;
        document.getElementById('victoire').innerHTML = "Victoire du Joueur " + + tabJoueur[y][i] ;
        if(tabJoueur[y][i] == 1){
          nbVictoire1++;
        }else{
          nbVictoire2++;
        }
      }
      varI--;
      varY++;
    }
  }
}


    }
  }


}



</script>
